# Edge Functions çµ±åˆãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

## çµ±åˆæ¦‚è¦

**ç¾åœ¨**: 11å€‹ã®Edge Functions â†’ **ç›®æ¨™**: 6å€‹ã®çµ±åˆé–¢æ•°

## çµ±åˆãƒãƒƒãƒ”ãƒ³ã‚°

### å‰Šé™¤å¯¾è±¡ï¼ˆ2å€‹ï¼‰
```
âŒ recommendations/                    â†’ å‰Šé™¤ï¼ˆenhanced_two_tower_recommendationsã«çµ±åˆæ¸ˆã¿ï¼‰
âŒ two_tower_recommendations/          â†’ å‰Šé™¤ï¼ˆ64æ¬¡å…ƒãƒ»æ—§å®Ÿè£…ï¼‰
```

### ä¿æŒãƒ»å¼·åŒ–å¯¾è±¡ï¼ˆ1å€‹ï¼‰
```
â­ enhanced_two_tower_recommendations/ â†’ recommendations/enhanced_two_tower/ ã«å†ç·¨æˆ
```

### çµ±åˆå¯¾è±¡ï¼ˆ5å€‹ï¼‰
```
âœ… likes/                             â†’ user-management/likes/
âœ… update_user_embedding/              â†’ user-management/embeddings/
âœ… delete_account/                     â†’ user-management/account/

âœ… feed_explore/                       â†’ content/feed/
âœ… videos-feed/                        â†’ content/feed/ (çµ±åˆ)
```

### backend/ç§»è¡Œå¯¾è±¡ï¼ˆ2å€‹ï¼‰
```
âš ï¸ dmm_sync/                          â†’ backend/data/sync/dmm/
âš ï¸ update_embeddings/                  â†’ backend/ml/preprocessing/embeddings/
```

### å¼·åŒ–å¯¾è±¡ï¼ˆ1å€‹ï¼‰
```
ğŸ”§ _shared/                           â†’ å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªå¤§å¹…å¼·åŒ–
```

## çµ±åˆå¾Œã®æ§‹é€ 

```
supabase/functions/
â”œâ”€â”€ recommendations/
â”‚   â””â”€â”€ enhanced_two_tower/           # ãƒ¡ã‚¤ãƒ³æ¨è–¦ã‚·ã‚¹ãƒ†ãƒ 
â”œâ”€â”€ user-management/
â”‚   â”œâ”€â”€ likes/                        # ã„ã„ã­ç®¡ç†
â”‚   â”œâ”€â”€ embeddings/                   # ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸ‹ã‚è¾¼ã¿æ›´æ–°
â”‚   â””â”€â”€ account/                      # ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†
â”œâ”€â”€ content/
â”‚   â””â”€â”€ feed/                         # çµ±åˆãƒ•ã‚£ãƒ¼ãƒ‰ï¼ˆexplore + videosï¼‰
â””â”€â”€ _shared/
    â”œâ”€â”€ database/                     # DBæ¥ç¶šãƒ»ã‚¯ã‚¨ãƒª
    â”œâ”€â”€ auth/                         # èªè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼
    â”œâ”€â”€ validation/                   # å…¥åŠ›æ¤œè¨¼
    â””â”€â”€ monitoring/                   # ãƒ­ã‚°ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹
```

## æ©Ÿèƒ½ä¿æŒãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### âœ… æ¨è–¦æ©Ÿèƒ½ï¼ˆå®Œå…¨ä¿æŒï¼‰
- [x] 768æ¬¡å…ƒTwo-Toweræ¨è–¦
- [x] ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦è¨ˆç®—
- [x] å¤šæ§˜æ€§å¼·åŒ–
- [x] æ¨è–¦ç†ç”±ç”Ÿæˆ
- [x] ã‚¸ãƒ£ãƒ³ãƒ«å—œå¥½åˆ†æ

### âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆå®Œå…¨ä¿æŒï¼‰
- [x] ã„ã„ã­è¿½åŠ ãƒ»å‰Šé™¤ãƒ»å–å¾—
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼åŸ‹ã‚è¾¼ã¿æ›´æ–°
- [x] ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå‰Šé™¤æ©Ÿèƒ½

### âœ… ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡ï¼ˆæ©Ÿèƒ½çµ±åˆï¼‰
- [x] æ¢ç´¢çš„ãƒ•ã‚£ãƒ¼ãƒ‰ï¼ˆå¤šæ§˜æ€§é‡è¦–ï¼‰
- [x] åŸºæœ¬ãƒ•ã‚£ãƒ¼ãƒ‰æ©Ÿèƒ½
- [x] æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ

### âš ï¸ ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼ˆbackendç§»è¡Œï¼‰
- [x] DMM APIåŒæœŸï¼ˆNode.jsç‰ˆä½¿ç”¨ï¼‰
- [x] åŸ‹ã‚è¾¼ã¿ãƒãƒƒãƒæ›´æ–°

## APIäº’æ›æ€§ãƒãƒˆãƒªã‚¯ã‚¹

| æ—§ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | æ–°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | äº’æ›æ€§ | å¯¾å¿œ |
|------------------|------------------|--------|------|
| `/recommendations` | `/recommendations/enhanced_two_tower` | ğŸ”„ Redirect | ãƒ—ãƒ­ã‚­ã‚·è¨­å®š |
| `/two_tower_recommendations` | `/recommendations/enhanced_two_tower` | ğŸ”„ Redirect | ãƒ—ãƒ­ã‚­ã‚·è¨­å®š |
| `/likes` | `/user-management/likes` | ğŸ”„ Redirect | ãƒ—ãƒ­ã‚­ã‚·è¨­å®š |
| `/update_user_embedding` | `/user-management/embeddings` | ğŸ”„ Redirect | ãƒ—ãƒ­ã‚­ã‚·è¨­å®š |
| `/delete_account` | `/user-management/account` | ğŸ”„ Redirect | ãƒ—ãƒ­ã‚­ã‚·è¨­å®š |
| `/feed_explore` | `/content/feed` | ğŸ”„ Redirect | ãƒ—ãƒ­ã‚­ã‚·è¨­å®š |
| `/videos-feed` | `/content/feed` | ğŸ”„ Redirect | ãƒ—ãƒ­ã‚­ã‚·è¨­å®š |

## ãƒªã‚¹ã‚¯è»½æ¸›ç­–

### 1. æ®µéšçš„ç§»è¡Œ
```
Phase 1: æ–°æ§‹é€ ä½œæˆï¼ˆæ—§æ§‹é€ ä¸¦è¡Œç¨¼åƒï¼‰
Phase 2: ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
Phase 3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ›´æ–°
Phase 4: æ—§é–¢æ•°å‰Šé™¤
```

### 2. äº’æ›æ€§ä¿æŒ
```typescript
// ãƒ—ãƒ­ã‚­ã‚·é–¢æ•°ä¾‹
export default async function handler(req: Request) {
  // æ—§ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ–°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  const url = new URL(req.url);
  url.pathname = '/functions/v1/recommendations/enhanced_two_tower';
  
  return fetch(url, req);
}
```

### 3. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥
```
- çµ±åˆå‰å¾Œã®æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
- APIäº’æ›æ€§ãƒ†ã‚¹ãƒˆ
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å›å¸°ãƒ†ã‚¹ãƒˆ
- ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
```

## å®Ÿè£…å„ªå…ˆé †ä½

### é«˜å„ªå…ˆåº¦ï¼ˆWeek 1-2ï¼‰
1. **enhanced_two_tower_recommendations å¼·åŒ–**
2. **user-management ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ**
3. **content ãƒ•ã‚£ãƒ¼ãƒ‰çµ±åˆ**

### ä¸­å„ªå…ˆåº¦ï¼ˆWeek 3ï¼‰
4. **_shared ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå¼·åŒ–**
5. **ãƒ—ãƒ­ã‚­ã‚·è¨­å®šå®Ÿè£…**

### ä½å„ªå…ˆåº¦ï¼ˆWeek 4ï¼‰
6. **backend/ ç§»è¡Œ**
7. **æ—§é–¢æ•°å‰Šé™¤**
8. **æœ€çµ‚æœ€é©åŒ–**

## æˆåŠŸæŒ‡æ¨™

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- [ ] å¿œç­”æ™‚é–“ <500ms ç¶­æŒ
- [ ] ã‚¨ãƒ©ãƒ¼ç‡ <1% ç¶­æŒ
- [ ] ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆå‘ä¸Š >20%

### ä¿å®ˆæ€§
- [ ] ã‚³ãƒ¼ãƒ‰é‡è¤‡ å‰Šæ¸› >50%
- [ ] é–¢æ•°æ•°å‰Šæ¸› 11å€‹â†’6å€‹
- [ ] å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆ©ç”¨ç‡ >80%

### å®‰å®šæ€§
- [ ] æ©Ÿèƒ½å›å¸° 0ä»¶
- [ ] APIäº’æ›æ€§ 100%
- [ ] ãƒ‡ãƒ¼ã‚¿æå¤± 0ä»¶

ã“ã®çµ±åˆã«ã‚ˆã‚Šã€ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ä¿å®ˆæ€§ã¨æ€§èƒ½ãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã™ã€‚