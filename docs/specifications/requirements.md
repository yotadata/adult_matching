# データ・モデル仕様要件定義書

**プロジェクト**: アダルト動画マッチングアプリケーション  
**文書バージョン**: v1.0  
**作成日**: 2025年9月3日  
**最終更新**: 2025年9月3日

---

## 📋 目次

1. [プロジェクト概要](#プロジェクト概要)
2. [ビジネス要件](#ビジネス要件)
3. [機能要件](#機能要件)
4. [データ要件](#データ要件)
5. [ML・AI要件](#mlai要件)
6. [品質要件](#品質要件)
7. [制約条件](#制約条件)

---

## 🎯 プロジェクト概要

### プロジェクトの目的
ユーザーの好みを学習し、パーソナライズされたアダルト動画推薦を提供するマッチングアプリケーションの構築

### ターゲットユーザー
- **主要ユーザー**: 18歳以上の成人男性・女性
- **想定規模**: 1万〜10万ユーザー（初期）
- **利用シーン**: プライベートな時間での動画探索・視聴

### 提供価値
1. **個人化推薦**: ユーザーの好みに基づく精度の高い動画推薦
2. **効率的な探索**: スワイプ操作による直感的なコンテンツ発見
3. **プライバシー保護**: 匿名性を重視したサービス設計

---

## 💼 ビジネス要件

### BR-001: 推薦精度の向上
- **要件**: ユーザーの「いいね」率を70%以上達成
- **測定方法**: 推薦動画に対するユーザーのいいね率
- **優先度**: 高

### BR-002: ユーザーエンゲージメント
- **要件**: 月間アクティブユーザー率80%以上維持
- **測定方法**: MAU/登録ユーザー数
- **優先度**: 高

### BR-003: 初回体験の最適化
- **要件**: 新規ユーザーが10分以内に好みの動画を発見
- **測定方法**: 初回セッションでのいいね発生時間
- **優先度**: 中

### BR-004: コンテンツの多様性
- **要件**: 様々なジャンル・カテゴリの動画を均等に推薦
- **測定方法**: 推薦されるジャンルの分布均一性
- **優先度**: 中

---

## ⚙️ 機能要件

### FR-001: ユーザー行動データ収集
- **機能**: ユーザーのスワイプ（いいね/スキップ）データ収集
- **入力**: ユーザーID、動画ID、アクション（いいね/スキップ）、タイムスタンプ
- **出力**: user_decisions テーブルへのデータ保存
- **優先度**: 高

### FR-002: 動画メタデータ管理
- **機能**: 動画の詳細情報（タイトル、出演者、ジャンル、タグ等）管理
- **入力**: 外部API（FANZA/DMM）からの動画メタデータ
- **出力**: videos テーブルへの構造化されたデータ保存
- **優先度**: 高

### FR-003: レビューデータ収集・分析
- **機能**: 外部レビューサイトからのレビューデータ収集とセンチメント分析
- **入力**: DMM/FANZAレビューページのHTML
- **出力**: 動画ごとの評価スコア、感情極性データ
- **優先度**: 中

### FR-004: リアルタイム推薦
- **機能**: ユーザーアクションに基づくリアルタイム動画推薦
- **入力**: ユーザーID、これまでの行動履歴
- **出力**: おすすめ動画リスト（スコア付き）
- **優先度**: 高

### FR-005: 冷開始問題の対応
- **機能**: 新規ユーザー・新規動画に対する推薦機能
- **入力**: 最小限のユーザー情報、動画メタデータ
- **出力**: 初期推薦リスト
- **優先度**: 高

---

## 📊 データ要件

### DR-001: ユーザー行動データ
```sql
-- 要件: ユーザーの全アクションを記録
user_decisions {
  user_id: UUID (匿名化)
  video_id: UUID
  action: ENUM('like', 'skip')
  timestamp: TIMESTAMP
  session_id: UUID
  context: JSONB (推薦理由、表示位置等)
}
```

### DR-002: 動画メタデータ
```sql
-- 要件: 推薦に必要な動画属性を網羅
videos {
  id: UUID
  title: TEXT
  description: TEXT
  duration: INTEGER (秒)
  release_date: DATE
  genres: TEXT[] (ジャンル配列)
  performers: TEXT[] (出演者配列)
  tags: TEXT[] (タグ配列)
  rating: FLOAT (評価スコア)
  view_count: INTEGER
  embedding: VECTOR(768) (コンテンツ埋め込み)
}
```

### DR-003: レビュー・感情データ
```sql
-- 要件: 動画の品質・人気度判定データ
video_reviews {
  video_id: UUID
  review_text: TEXT
  rating: FLOAT (1-5スケール)
  sentiment_score: FLOAT (-1 to 1)
  helpful_votes: INTEGER
  source: TEXT (レビューサイト)
  created_at: TIMESTAMP
}
```

### DR-004: ユーザー埋め込みベクトル
```sql
-- 要件: ユーザーの好み表現データ
user_embeddings {
  user_id: UUID
  embedding: VECTOR(768)
  updated_at: TIMESTAMP
  confidence_score: FLOAT (0-1)
}
```

### DR-005: データ量・性能要件
- **動画データ**: 10万本以上の動画メタデータ
- **ユーザー行動**: 1日あたり100万アクション
- **レビューデータ**: 動画あたり平均50件のレビュー
- **応答時間**: 推薦API応答時間500ms以下
- **データ更新**: 新規動画は24時間以内にシステム反映

---

## 🤖 ML・AI要件

### ML-001: 推薦モデル（Two-Tower Architecture）
- **アーキテクチャ**: Two-Tower（ユーザーtower + アイテムtower）
- **入力**: 
  - ユーザー: 行動履歴、好みプロファイル
  - アイテム: 動画メタデータ、コンテンツ埋め込み
- **出力**: ユーザー-動画マッチングスコア（0-1）
- **要件**: AUC 0.75以上の予測精度

### ML-002: コンテンツ埋め込み
- **手法**: BERT日本語モデル + マルチモーダル学習
- **入力**: 動画タイトル、説明文、メタデータ
- **出力**: 768次元密ベクトル
- **要件**: 類似動画の埋め込み距離相関係数0.7以上

### ML-003: ユーザー埋め込み
- **手法**: 行動履歴に基づく学習済み埋め込み
- **入力**: いいね履歴、視聴履歴、時系列パターン
- **出力**: 768次元密ベクトル（コンテンツ空間と同次元）
- **要件**: リアルタイム更新（アクション発生から1分以内）

### ML-004: モデル学習・更新
- **バッチ学習**: 週次でのフルモデル再学習
- **オンライン学習**: ユーザー埋め込みの増分更新
- **A/Bテスト**: 新モデルの段階的ロールアウト
- **モデルドリフト検知**: 性能低下の自動検知・アラート

### ML-005: 特徴量エンジニアリング
- **テキスト特徴量**: TF-IDF、BERT埋め込み、感情スコア
- **行動特徴量**: クリック率、視聴時間、セッションパターン
- **時間特徴量**: 曜日・時間帯・季節性
- **コンテンツ特徴量**: ジャンル、出演者、長さ、評価

---

## 🔍 品質要件

### QR-001: 性能要件
- **推薦API応答時間**: 95%のリクエストで500ms以下
- **システム可用性**: 99.5%以上（月間ダウンタイム3.6時間以下）
- **同時接続ユーザー**: 1,000ユーザー/秒の負荷に対応
- **データ更新遅延**: 新規データの反映は24時間以内

### QR-002: 精度要件
- **推薦精度**: いいね率70%以上、AUC 0.75以上
- **多様性**: 推薦リストの上位10件で最低5つの異なるジャンル
- **新規性**: 推薦の30%は過去1ヶ月以内の新規動画
- **個人化度**: 異なるユーザー間の推薦重複率30%以下

### QR-003: データ品質
- **完整性**: 必須フィールド（タイトル、ID等）の欠損率1%以下
- **一貫性**: データベース間の情報整合性99%以上
- **鮮度**: 動画メタデータの更新頻度は週次
- **正確性**: レビューデータの感情分析精度80%以上

### QR-004: セキュリティ・プライバシー
- **匿名化**: ユーザーIDの完全匿名化
- **データ暗号化**: 個人データの保存・転送時暗号化
- **アクセス制御**: 年齢認証の確実な実装
- **データ保持**: ユーザーデータの適切な保持期間管理

---

## 🚫 制約条件

### TC-001: 技術制約
- **プラットフォーム**: Supabase（PostgreSQL）+ Next.js
- **ML環境**: Python 3.12 + TensorFlow/PyTorch
- **デプロイ**: Supabase Edge Functions
- **ストレージ**: Supabase Storage (動画メタデータのみ)

### TC-002: データ制約
- **外部データソース**: DMM/FANZA APIのみ利用可能
- **レビューデータ**: 公開レビューサイトからのスクレイピング
- **動画ファイル**: 実際の動画ファイルは扱わない（メタデータのみ）
- **データベース**: Supabaseの容量・性能制限内

### TC-003: 法的・倫理制約
- **年齢制限**: 18歳以上のユーザーのみ対象
- **コンテンツ規制**: 各国の法令・規制に準拠
- **プライバシー**: GDPR等のデータ保護規則遵守
- **著作権**: メタデータのみ利用、動画コンテンツは外部リンク

### TC-004: リソース制約
- **開発期間**: 初期バージョンは3ヶ月以内
- **開発体制**: 1-2名での開発
- **予算**: 月額$100以下のインフラコスト
- **メンテナンス**: 週10時間以下のメンテナンス作業

---

## 📈 成功指標

### 短期指標（リリース後1ヶ月）
- [ ] ユーザー登録率: 訪問者の10%以上が登録
- [ ] いいね率: 推薦動画の60%以上がいいね
- [ ] セッション継続率: 初回訪問時に10分以上利用

### 中期指標（リリース後3ヶ月）
- [ ] MAU: 月間1,000アクティブユーザー
- [ ] いいね率: 70%以上を安定維持
- [ ] ユーザー満足度: アンケートで4.0/5.0以上

### 長期指標（リリース後6ヶ月）
- [ ] ユーザー基盤: 10,000登録ユーザー
- [ ] 推薦精度: AUC 0.75以上
- [ ] 収益性: インフラコスト回収可能なビジネスモデル確立

---

## 🔄 要件変更管理

### 変更承認プロセス
1. 要件変更提案の文書化
2. 影響範囲・コストの評価
3. 優先度の再評価
4. 承認・却下の決定
5. 関連文書の更新

### 変更履歴
| 日付 | バージョン | 変更内容 | 承認者 |
|------|------------|----------|---------|
| 2025-09-03 | v1.0 | 初版作成 | - |

---

**文書管理**  
**作成者**: Claude Code  
**承認者**: -  
**次回レビュー予定**: 2025年10月