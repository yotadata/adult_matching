# AIレコメンド画面仕様 v1

本ドキュメントは、スワイプ画面と機能が重複しない「AIレコメンド」画面のコンセプト・UX・必要機能を整理したものです。スワイプ UI はリアルタイムな意思決定体験に特化しているため、AIレコメンド画面では「嗜好の可視化」「テーマ別の深掘り」「プレイリスト化」に主軸を置きます。

## 1. 目的と役割
- ユーザーの過去評価を踏まえ、AIが「なぜ」その作品を薦めるのかを説明しながらレコメンドする。
- 気分・利用シーンに合わせたテーマ（モード）を切り替え、短時間で視聴候補を確定させる。
- まとまった候補を俯瞰し、自分に合いそうなラインを一気に決めることで「次に何を観るか」を素早く判断できるようにする。

> **差別化ポイント:** スワイプは「1枚ずつ評価するアクション」。AIレコメンド画面は「まとめて理解・比較し、視聴キューを組むアクション」に集中する。

## 2. 想定ユースケース
1. 今日はどんなジャンルを見ればいいか、AIの提案を俯瞰して決めたい。
2. 同じ嗜好を持つユーザーが今見ている作品を知りたい。
3. 出張・移動中など時間制限がある状況で、短時間で満足できる候補セットを生成したい。
4. パートナーと視聴するために、共有向けプレイリストを作成したい。

## 3. 成功指標（KPI）
- `ai_rec_mode_switch`：テーマ切替（モード変更）の利用率。
- `ai_rec_reason_expand`：レコメンド理由展開の閲覧回数。
- `ai_rec_custom_apply`：カスタムモード適用率。

## 4. 画面全体レイアウト
2カラム構成（デスクトップ） / 1カラム縦積み（モバイル）。

| カラム | コンテンツ | 目的 |
| ------ | ---------- | ---- |
| 左 | セッションサマリ & モード設定 | 今日の嗜好サマリとAIに与える意図の設定 |
| 右 | AIが生成したセッション（最大3ブロック） | 候補作品の比較・選択 |

### 4.1 ヘッダー（全幅）
- タイトル: 「AIで探す」
- サブコピー: 「今日の気分と最近の嗜好から、最短ルートで作品を見つけましょう。」
- アクション: `再生成`（AIに再度まとめ直させる）、`ガイドを見る`（チュートリアルモーダル）

### 4.2 左カラム：インサイト & モード設定
1. **嗜好サマリカード**
   - 今週のトップタグ・出演者・視聴時間傾向を小さなチャートで表示。
   - データソース: `analysis-results` Edge Function。
2. **モードプリセット**
   - プルダウンではなくカード型ボタンで表示。例: `集中して楽しむ (Focus)`, `パートナーと`, `サクッと`, `新しい刺激`, `落ち着いて観る`。
   - 1つ選択で中央カラムの提案が更新される。
3. **カスタムモードビルダー**
   - トグル/スライダーで指定:
     - 視聴時間（ショート / ミディアム / ロング）
     - 気分（甘め / 情熱的 / 癒やし / ニッチ）
     - 視聴環境（ひとり / パートナー / 公開不可）
   - `AIに依頼`ボタンで意図を適用し、即時提案更新。

### 4.3 中央カラム：AIセッション提案
各モードで最大3セクション（例: 「集中セット」「チャレンジ枠」「定番フォローアップ」）。

セクション構成:
- **ヘッダー:** セクション名 + 推薦理由のサマリ（例: `最近LIKEした#制服を強化するラインナップ`）
- **カードリスト:** 横スクロール可能なカード（5件程度）。カード内容は以下:
  - サムネイル
  - タイトル（2行まで）
  - タグバッジ 2つ
  - 推薦理由チップ（例: `視聴時間 25分 / 最近の似た作品`）
  - アクション: `詳細を見る`, `作品ページへ`, `AIに似た作品を再提案`（将来オプション）
- **セクションアクション:** `共有リンク生成`, `履歴比較`

#### 推薦理由の詳細
- カード右上の `i` アイコンでモーダルを開き、以下を表示:
  - 選定理由（タグ・出演者・視聴時間・類似ユーザー根拠）。
  - "あなたが最近LIKEした作品" と "似ている理由" の比較。
  - `似ていない理由`（除外された他候補があればサマリ）。

## 5. 主要インタラクション
| シナリオ | 詳細 | 備考 |
| -------- | ---- | ---- |
| モード切替 | プリセットカードをクリックすると中央カラムのセッション3ブロックが再生成される。 | 再生成時にローディングスケルトン表示（500ms以上なら）。 |
| カスタムモード更新 | スライダー変更時はUI更新のみ、`AIに依頼`でAPI呼び出し。 | 呼び出し時にUser IntentをEdge Functionへ送る。 |
| 推薦理由展開 | 各カードの `i` アイコンクリックでモーダル。 | モーダルでは説明テキストや類似指標を確認できる。 |
| セクション共有 | セクションヘッダーの共有ボタンからURLをコピー。 | 共有URL仕様は別途定義。 |

## 6. データフロー / 必要API
1. **AIレコメンド Edge Function 拡張**
   - 入力: `mode_id`, `custom_intent`, `limit_per_section`.
   - 出力: `sections: Array<{ id, title, rationale, items[] }>` 形式。
   - `items[].explainability`: 類似度スコア、根拠タグ、理由文章。
2. **嗜好サマリ API**
   - 既存 `analysis-results` を利用。レスポンスに `top_tags`, `top_performers`, `recent_like_durations` などを含める。

## 7. 非機能要件
- 既存のGlassmorphismテーマに準拠。
- `lg` 以上で左固定（320px）＋右可変2カラム、`md` 以下でコンテンツ順番を変更（中央→左）。
- レイテンシが1.5秒を超える場合は「AIが考え中」のアニメーション（Lottie想定）を表示。
- 推薦結果はユーザー操作なし状態で10分キャッシュし、再生成要求時に明示的なリロードトーストを表示（任意）。

## 8. アクセシビリティ & i18n
- モードカードはキーボード操作可能にする（`role="radio"` + `aria-checked`）。
- 推薦理由モーダルは `focus trap` を適用し、閉じた後は呼び出し元フォーカスへ戻す。
- 将来的な多言語対応に備え、説明テキストは翻訳辞書化を想定。

## 9. 開発タスク整理
### フロントエンド
- 新UIコンポーネント群（モードピッカー、セクションカード、推薦理由モーダル）の実装。
- `useAiRecommend` フックの拡張（mode/customIntent パラメータ対応、セクション型レスポンス受け取り）。
- セクション共有や説明展開に伴う計測イベントの実装。

### バックエンド（Edge Functions）
- `ai-recommend` の改修: Two-Towerスコアに加えて、タグクラスタリングと説明テキスト生成を行う。

### 分析/計測
- `ai_rec_*` 系イベントの実装 (`frontend/src/lib/analytics.ts` 経由)。
- カスタムイベントのDebugView検証と BigQuery エクスポート設定。

## 10. 現行実装との差分と確認事項
- 現状の `frontend/src/app/ai-recommend/page.tsx` は単純なグリッド表示で、モード選択や説明付きセクション構成が存在しない。
- Edge Function `supabase/functions/ai-recommend/index.ts` はセクション構造・理由文生成を備える必要がある。
- コンシェルジュで多量の動画を提示し、スワイプは探索・評価に専念するという役割分担を維持する。

---

更新日: 2025-11-06  
策定者: （記入者名を追記してください）
