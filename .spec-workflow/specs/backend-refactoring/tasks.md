# タスク文書

<!-- AI Instructions: 各タスクには、以下の形式に従った構造化AI ガイダンスを含む _Prompt フィールドを生成する:
_Prompt: Role: [専門開発者の役割] | Task: [コンテキスト参照を含む明確なタスク説明] | Restrictions: [制約事項、やってはいけないこと] | Success: [具体的な完了基準]_
これにより、単純な「このタスクに取り組んで」という指示を超えた、より良いAIエージェントガイダンスを提供する。 -->

## フェーズ1: Supabase設定強化

- [x] 1. 環境別設定ファイルのセットアップ
  - ファイル: supabase/config.local.toml, supabase/config.production.toml
  - 開発環境と本番環境の設定ファイルを作成
  - シークレット管理用の環境変数実装
  - 目的: 環境別デプロイと安全なシークレット管理の有効化
  - _活用: supabase/config.toml_
  - _要件: 要件4_
  - _Prompt: Role: 設定管理と環境分離を専門とするDevOpsエンジニア | Task: 既存のconfig.tomlを拡張して環境別Supabase設定ファイルを作成し、要件4に従ってAPIキーとシークレットの安全な環境変数管理を実装 | Restrictions: シークレットをバージョン管理にコミットしない、既存config.tomlとの後方互換性を維持、本番シークレットは全て環境変数を使用 | Success: 環境別設定が正常に動作、シークレットが適切に外部化、開発・本番環境を独立してデプロイ可能_

- [x] 2. 設定のセキュリティ強化
  - ファイル: supabase/config.toml（既存を修正）
  - より厳格なレート制限とCORS設定の実装
  - 強化されたRLSポリシーとAPIセキュリティの設定
  - 目的: システムセキュリティの向上と悪用防止
  - _活用: supabase/config.toml 既存セキュリティ設定_
  - _要件: 要件4_
  - _Prompt: Role: APIセキュリティとSupabase設定を専門とするセキュリティエンジニア | Task: Supabase設定でセキュリティ設定を強化し、要件4に従ってより厳格なレート制限、CORSポリシー、APIセキュリティ対策を実装 | Restrictions: 既存機能を破らない、後方互換性を確保、センシティブなエンドポイントを公開しない | Success: セキュリティ設定が適切に構成、レート制限が悪用を防止、CORSは制限的だが機能的、APIエンドポイントが適切に保護_

- [x] 3. PostgreSQLとpgvector設定の最適化
  - ファイル: supabase/config.toml（既存を修正）
  - 768次元埋め込みに最適化されたpgvector設定
  - 接続プールとパフォーマンス設定の最適化
  - 目的: ベクター操作のデータベースパフォーマンス最大化
  - _活用: 既存のpgvector 768次元実装_
  - _要件: 非機能要件 - パフォーマンス_
  - _Prompt: Role: PostgreSQLとベクターデータベースを専門とするデータベース管理者 | Task: 768次元埋め込みと高性能ベクター操作のためのPostgreSQLとpgvector設定を最適化し、パフォーマンス要件に従って実装 | Restrictions: データ整合性を維持、既存スキーマを変更しない、現在のデータ量で動作する設定を確保 | Success: ベクター検索パフォーマンスが最適化、接続プールが効率的、データベースが目標負荷を<500ms応答時間で処理可能_

## フェーズ2: Edge Functions統合

- [x] 4. 現在のEdge Functions監査と分析
  - ファイル: supabase/functions/*（全て分析）
  - 各現在の関数の機能と依存関係を文書化
  - 重複機能と最適化機会の特定
  - 目的: 統合ロードマップ作成と機能損失防止
  - _活用: enhanced_two_tower_recommendations、real_dmm_sync.js パターン_
  - _要件: 要件1_
  - _Prompt: Role: SupabaseEdge Functionsとコード分析を専門とするシステムアナリスト | Task: 統合計画のために要件1に従って全Edge Functionsの包括的監査を実施し、機能、依存関係、重複機能を文書化 | Restrictions: 分析中は関数を変更しない、全機能を確実に文書化、重要vs冗長な関数を特定 | Success: 全関数の完全な文書化が存在、統合ロードマップが明確、リファクタリング中に重要機能が失われない_

- [x] 5. 統合推薦関数の作成
  - ファイル: supabase/functions/recommendations/enhanced_two_tower/index.ts
  - recommendations、two_tower_recommendationsを拡張実装に統合
  - 後方互換性を持つ統一APIインターフェースの実装
  - 目的: 単一の最適化された推薦エンドポイント提供
  - _活用: enhanced_two_tower_recommendations 既存実装_
  - _要件: 要件1_
  - _Prompt: Role: SupabaseEdge Functionsと機械学習APIを専門とするバックエンド開発者 | Task: 要件1に従って既存実装をenhanced_two_towerシステムに統合し、後方互換性を維持した統合推薦関数を作成 | Restrictions: 既存フロントエンド統合を破らない、APIコントラクト互換性を維持、パフォーマンスを維持または改善 | Success: 単一推薦エンドポイントが正常動作、既存機能全て保持、API パフォーマンスが<500ms要件を満たす_

- [x] 6. ユーザー管理関数グループの作成
  - ファイル: supabase/functions/user-management/likes/index.ts, embeddings/index.ts, account/index.ts
  - likes、update_user_embedding、delete_account関数の統合
  - 共有認証と検証ユーティリティの実装
  - 目的: 保守性向上のための関連ユーザー操作のグループ化
  - _活用: 既存のlikes、update_user_embedding、delete_account実装_
  - _要件: 要件1_
  - _Prompt: Role: ユーザー管理システムとSupabaseEdge Functionsを専門とするAPI開発者 | Task: 要件1に従ってlikes、埋め込み更新、アカウント操作を整理し、統合ユーザー管理関数グループを作成 | Restrictions: 既存APIコントラクトを維持、全エンドポイントで適切な認証を確保、ユーザーデータ整合性を破らない | Success: ユーザー管理関数が適切に整理、共有ユーティリティがコード重複を削減、全ユーザー操作が適切なセキュリティで正常動作_

- [x] 7. コンテンツ関数グループの作成
  - ファイル: supabase/functions/content/feed/index.ts
  - feed_exploreとvideos-feedを統一コンテンツAPIに統合
  - 柔軟なコンテンツフィルタリングとページネーション実装
  - 目的: 統一コンテンツ配信インターフェース提供
  - _活用: feed_exploreとvideos-feed既存実装_
  - _要件: 要件1_
  - _Prompt: Role: フィードシステムとコンテンツ配信を専門とするコンテンツAPI開発者 | Task: 要件1に従ってfeed_exploreとvideos-feed実装を統合し、統一コンテンツ関数を作成 | Restrictions: 既存フィードタイプ全てをサポート、ページネーションパフォーマンスを維持、コンテンツフィルタリングが正常動作 | Success: 統一コンテンツAPIが全フィードタイプを正しく提供、ページネーションが効率的、コンテンツフィルタリングがユーザー期待を満たす_

- [x] 8. _sharedフォルダ内共有ユーティリティの強化
  - ファイル: supabase/functions/_shared/*（既存を拡張）
  - データベース接続ユーティリティ、認証ヘルパー、検証関数の作成
  - 監視とログユーティリティの実装
  - 目的: コード重複削減と保守性向上
  - _活用: 既存_sharedユーティリティ_
  - _要件: 要件1_
  - _Prompt: Role: 共有ライブラリとコード再利用パターンを専門とするユーティリティ開発者 | Task: 要件1に従って_sharedフォルダの共有ユーティリティを強化し、データベース、認証、検証、監視ユーティリティを作成 | Restrictions: 既存関数依存関係を破らない、ユーティリティを十分にテスト、後方互換性を維持 | Success: 共有ユーティリティがコード重複を大幅削減、全関数が共通ユーティリティを正しく使用、ユーティリティが十分に文書化・テストされている_

## フェーズ3: バックエンドフォルダ構造作成

- [x] 9. backend/mlディレクトリ構造の作成
  - ディレクトリ: backend/ml/models, training, preprocessing, inference, evaluation
  - 標準化されたMLパイプラインディレクトリ構造のセットアップ
  - 768次元モデルを標準実装として移行
  - 目的: 保守性とスケーラビリティ向上のためのMLコンポーネント整理
  - _活用: ml_pipeline/ 既存構造と768次元モデル_
  - _要件: 要件2_
  - _Prompt: Role: MLパイプライン組織とモデル管理を専門とするMLエンジニア | Task: 要件2に従って既存MLコンポーネントを移行し、768次元実装を標準化した組織的backend/mlディレクトリ構造を作成 | Restrictions: モデルアーティファクトを失わない、トレーニングスクリプトが継続動作を確保、モデルバージョニングを維持 | Success: MLパイプラインが適切に整理、768次元モデルが標準、既存ML機能全てが保持・改善_

- [x] 10. MLトレーニングコンポーネントの移行
  - ファイル: backend/ml/training/trainers/, configs/, scripts/
  - scripts/とml_pipeline/training/からトレーニングスクリプトを移動・統合
  - 統一トレーニングインターフェースと設定システムの作成
  - 目的: トレーニングロジックの集約と重複削減
  - _活用: rating_based_two_tower_trainer、enhanced_two_tower_trainer_
  - _要件: 要件2_
  - _Prompt: Role: モデルトレーニングパイプラインと設定管理を専門とするMLトレーニングエンジニア | Task: 要件2に従ってMLトレーニングコンポーネントを移行・統合し、統一トレーニングインターフェースを作成 | Restrictions: 全トレーニング機能を保持、設定に柔軟性を確保、既存モデルトレーニングを破らない | Success: トレーニングパイプラインが統一・適切に整理、設定システムが柔軟、全トレーニングスクリプトが新構造で正常動作_

- [x] 11. ML前処理コンポーネントの移行
  - ファイル: backend/ml/preprocessing/features/, embeddings/, utils/
  - ml_pipeline/preprocessing/から前処理ロジックを移動
  - 標準化された特徴量処理インターフェースの作成
  - 目的: 特徴量処理と埋め込み管理の整理
  - _活用: enhanced_item_feature_processor、real_user_feature_extractor_
  - _要件: 要件2_
  - _Prompt: Role: 特徴量エンジニアリングとデータ前処理を専門とするデータエンジニア | Task: 要件2に従ってML前処理コンポーネントを移行し、標準化された特徴量処理インターフェースを作成 | Restrictions: データ処理品質を維持、特徴量互換性を確保、既存前処理パイプラインを破らない | Success: 前処理パイプラインが適切に整理、特徴量処理が標準化、全データ変換が正常動作_

- [x] 12. backend/dataディレクトリ構造の作成
  - ディレクトリ: backend/data/sync, processing, storage, quality
  - データ管理パイプライン構造のセットアップ
  - データ処理コンポーネント移行の計画
  - 目的: 管理・監視向上のためのデータ操作整理
  - _活用: data_processing/ 既存構造_
  - _要件: 要件3_
  - _Prompt: Role: データパイプライン組織とデータ管理を専門とするデータアーキテクト | Task: 要件3に従ってデータ操作のための組織的backend/dataディレクトリ構造を作成 | Restrictions: 既存データ操作全てを計画、データフロー継続性を確保、データ品質基準を維持 | Success: データパイプライン構造が論理的・スケーラブル、全データ操作が適切に整理、データフローが最適化_

- [x] 13. DMM同期操作の移行
  - ファイル: backend/data/sync/dmm/
  - DMM API統合スクリプトの移動と統一同期サービスの作成
  - 同期操作の監視とエラーハンドリング実装
  - 目的: 外部API統合の集約と信頼性向上
  - _活用: real_dmm_sync.js 実証済み実装_
  - _要件: 要件3_
  - _Prompt: Role: 外部API統合とデータ同期を専門とする統合エンジニア | Task: 要件3に従ってDMM同期操作を移行し、監視とエラーハンドリングを備えた統一同期サービスを作成 | Restrictions: APIレート制限を維持、データ整合性を確保、既存同期機能を破らない | Success: DMM同期が信頼性高く適切に監視、API統合がベストプラクティスに従う、データ同期が一貫・エラー耐性_

- [x] 14. データ処理と品質管理の作成
  - ファイル: backend/data/processing/, quality/
  - データクリーニングと処理ユーティリティの移行
  - データ品質監視と検証の実装
  - 目的: データ品質と処理一貫性の確保
  - _活用: data_processing/utils/ 既存実装_
  - _要件: 要件3_
  - _Prompt: Role: データ検証と処理パイプライン管理を専門とするデータ品質エンジニア | Task: 要件3に従って既存ユーティリティを移行し、データ処理と品質管理システムを作成 | Restrictions: データ品質基準を維持、処理一貫性を確保、データ検証ロジックを失わない | Success: データ処理が一貫・適切に監視、データ品質検証が包括的、処理パイプラインが信頼性高い_

## フェーズ4: スクリプト整理と移行

- [x] 15. 既存スクリプトの監査と分類
  - ファイル: scripts/*（50+ファイル全て分析）
  - スクリプトを機能別に分類: トレーニング、同期、テスト、保守
  - 削除対象の非推奨・重複スクリプトの特定
  - 目的: 整理されたスクリプト移行計画の作成
  - _活用: 既存スクリプト機能分析_
  - _要件: 要件4_
  - _Prompt: Role: スクリプト管理と自動化を専門とするシステム管理者 | Task: 要件4に従って全既存スクリプトを監査・分類し、整理された移行計画を作成 | Restrictions: 全スクリプト依存関係を特定、重要スクリプトを見逃さない、スクリプト目的を明確に文書化 | Success: 全スクリプトが適切に分類、移行計画が包括的、非推奨スクリプトが安全削除用に特定_

- [x] 16. トレーニングスクリプトのbackend/ml/training/scripts/への移行
  - ファイル: backend/ml/training/scripts/
  - scripts/ディレクトリからトレーニング関連スクリプトを移動
  - 新場所用のパスと依存関係の更新
  - 目的: トレーニングスクリプトとMLパイプラインの統合
  - _活用: train_*.py、test_*_model.pyスクリプト_
  - _要件: 要件4_
  - _Prompt: Role: MLオペレーションエンジニアでトレーニングスクリプト管理とパイプライン自動化を専門 | Task: 要件4に従ってトレーニングスクリプトをMLトレーニングディレクトリに移行し、パスと依存関係を更新 | Restrictions: スクリプト機能を維持、全パス参照を更新、新環境でスクリプト動作を確保 | Success: 全トレーニングスクリプトが新場所で正常動作、依存関係が適切に解決、トレーニングパイプラインが完全機能_

- [x] 17. 保守・テストスクリプトの移行
  - ファイル: backend/scripts/maintenance/, testing/
  - 保守・テストスクリプトを整理された構造に移動
  - スクリプト文書と使用ガイドの作成
  - 目的: 保守性向上のための運用スクリプト整理
  - _活用: analyze_*.js、quick_db_check.js、test_*.pyスクリプト_
  - _要件: 要件4_
  - _Prompt: Role: 運用スクリプト管理と文書化を専門とするDevOpsエンジニア | Task: 要件4に従って保守・テストスクリプトを文書と共に整理された構造に移行 | Restrictions: 全スクリプト機能を維持、包括的文書を作成、スクリプトを容易に発見可能にする | Success: スクリプトが適切に整理・文書化、保守操作が合理化、テストスクリプトが容易にアクセス可能_

- [x] 18. 移行・デプロイメントスクリプトの作成
  - ファイル: backend/scripts/migration/, deployment/
  - データ移行とシステムデプロイメント用スクリプトの作成
  - 自動デプロイメント手順の実装
  - 目的: デプロイメントと移行操作のサポート
  - _活用: 既存デプロイメントパターンと移行ロジック_
  - _要件: 要件4_
  - _Prompt: Role: デプロイメント自動化とデータ移行を専門とするDevOpsエンジニア | Task: 要件4に従って自動操作のための移行・デプロイメントスクリプトを作成 | Restrictions: 安全なデータ移行を確保、ロールバック機能を実装、デプロイメント手順を十分にテスト | Success: 移行スクリプトが安全動作、デプロイメントが自動化・信頼性高い、ロールバック手順がテスト・文書化済み_

## フェーズ5: テストと検証

- [x] 19. 包括的テスト戦略の作成
  - ファイル: backend/tests/unit/, integration/, e2e/
  - テストフレームワークとディレクトリ構造のセットアップ
  - リファクタリングされた全コンポーネントのテストカバレッジ計画
  - 目的: リファクタリングが機能を破らないことの確保
  - _活用: 既存テストパターンとユーティリティ_
  - _要件: 要件5_
  - _Prompt: Role: テスト戦略とテスト自動化フレームワークを専門とするQAアーキテクト | Task: 要件5に従ってリファクタリングされたバックエンドコンポーネントの包括的テスト戦略を作成 | Restrictions: ≥95%コードカバレッジを達成、テストを保守可能にする、全重要機能をカバー | Success: テスト戦略が包括的・達成可能、テストフレームワークが適切に設定、カバレッジ目標が現実的・測定可能_

- [x] 20. Edge Functions単体テストの実装
  - ファイル: backend/tests/unit/functions/
  - 統合されたEdge Functions用単体テストの作成
  - APIコントラクトとエラーハンドリングのテスト
  - 目的: 統合後にEdge Functionsが正常動作することの確保
  - _活用: 既存関数実装とテストパターン_
  - _要件: 要件5_
  - _Prompt: Role: SupabaseEdge Functionsテストとapiテストを専門とするバックエンドテストエンジニア | Task: 要件5に従って統合Edge FunctionsのAPIコントラクトとエラーハンドリングをテストする単体テストを作成 | Restrictions: 全APIエンドポイントをテスト、外部依存関係を適切にモック、テストを分離実行 | Success: 全Edge Functionsが十分にテスト、APIコントラクトが検証、エラーシナリオがカバー_

- [x] 21. MLパイプライン統合テストの実装
  - ファイル: backend/tests/integration/ml/
  - MLトレーニングと推論パイプライン用統合テストの作成
  - モデル読み込み、トレーニング、予測ワークフローのテスト
  - 目的: リファクタリング後にMLパイプラインがエンドツーエンドで動作することの確保
  - _活用: 既存MLモデルとトレーニングデータ_
  - _要件: 要件5_
  - _Prompt: Role: MLパイプラインテストとモデル検証を専門とするMLテストエンジニア | Task: 要件5に従ってMLトレーニングと推論パイプラインの統合テストを作成 | Restrictions: 完全MLワークフローをテスト、モデル精度維持を確保、現実的データ量でテスト | Success: MLパイプラインがエンドツーエンドで十分にテスト、モデルパフォーマンスが精度要件(AUC-PR ≥ 0.85)を満たす、トレーニングと推論が正常動作_

- [x] 22. データ処理統合テストの実装
  - ファイル: backend/tests/integration/data/
  - データ同期、処理、品質検証用テストの作成
  - DMM API統合とデータ変換のテスト
  - 目的: リファクタリング後にデータパイプラインが正常動作することの確保
  - _活用: 既存データ処理ロジックとDMM API統合_
  - _要件: 要件5_
  - _Prompt: Role: データパイプラインテストとAPI統合テストを専門とするデータテストエンジニア | Task: 要件5に従ってDMM API統合を含むデータ処理パイプラインの統合テストを作成 | Restrictions: データ整合性をテスト、テストでAPIレート制限を処理、データ品質検証動作を確保 | Success: データパイプラインが十分にテスト、DMM API統合が信頼性高い、処理全体でデータ品質が維持_

- [x] 23. エンドツーエンドシステムテストの作成
  - ファイル: backend/tests/e2e/
  - ユーザーワークフローをカバーする包括的システムテストの作成
  - パフォーマンス要件とシステム信頼性のテスト
  - 目的: リファクタリング後の完全システム機能の検証
  - _活用: 既存システム機能とユーザーワークフロー_
  - _要件: 要件5_
  - _Prompt: Role: エンドツーエンドテストとパフォーマンステストを専門とするシステムテストエンジニア | Task: 要件5に従ってユーザーワークフローとパフォーマンス要件をカバーする包括的システムテストを作成 | Restrictions: 現実的ユーザーシナリオをテスト、パフォーマンス目標を検証(<500ms推薦)、負荷下でシステム信頼性を確保 | Success: システムテストが全重要ユーザーワークフローをカバー、パフォーマンス要件達成、負荷下でシステム信頼性が検証_

## フェーズ6: デプロイメントと監視

- [x] 24. デプロイメント自動化の作成
  - ファイル: backend/scripts/deployment/
  - リファクタリングされたシステム用自動デプロイメントスクリプトの実装
  - ロールバック手順とヘルスチェックの作成
  - 目的: リファクタリングされたシステムの安全で信頼性の高いデプロイメント
  - _活用: 既存デプロイメントパターンとSupabase CLI_
  - _要件: 非機能要件 - 信頼性_
  - _Prompt: Role: デプロイメント自動化とシステム信頼性を専門とするDevOpsエンジニア | Task: 信頼性要件に従ってロールバック手順とヘルスチェックを備えた自動デプロイメントスクリプトを作成 | Restrictions: ゼロダウンタイムデプロイメントを確保、包括的ヘルスチェックを実装、ロールバック手順をテスト | Success: デプロイメントが自動化・信頼性高い、ロールバック手順が正常動作、ヘルスチェックがシステム状態を検証_

- [x] 25. 監視とログの実装
  - ファイル: backend/monitoring/, supabase/functions/_shared/monitoring/
  - リファクタリングされたコンポーネント用監視のセットアップ
  - 重要操作用ログとアラートの実装
  - 目的: リファクタリング後のシステム健全性とパフォーマンスの監視
  - _活用: 既存監視パターンとSupabase analytics_
  - _要件: 非機能要件 - 信頼性_
  - _Prompt: Role: 監視と可観測性を専門とするサイト信頼性エンジニア | Task: 信頼性要件に従ってリファクタリングされたシステムの包括的監視とログを実装 | Restrictions: 全重要コンポーネントを監視、アラートを実行可能にする、監視オーバーヘッドを低く維持 | Success: システム監視が包括的、アラートが意味のある実行可能、パフォーマンスメトリクスが追跡・可視化_

- [x] 26. パフォーマンス最適化と検証
  - ファイル: パフォーマンス重要な各種コンポーネント
  - テスト中に特定されたパフォーマンスボトルネックの最適化
  - パフォーマンス要件達成の検証
  - 目的: リファクタリングされたシステムがパフォーマンス目標を満たすことの確保
  - _活用: パフォーマンステスト結果とボトルネック分析_
  - _要件: 非機能要件 - パフォーマンス_
  - _Prompt: Role: システム最適化とパフォーマンスチューニングを専門とするパフォーマンスエンジニア | Task: パフォーマンス要件に従ってパフォーマンスボトルネックを最適化し、パフォーマンス要件を検証 | Restrictions: 最適化中に機能を維持、最適化の持続可能性を確保、現実的負荷下で検証 | Success: システムがパフォーマンス目標達成(<500ms推薦、<2時間トレーニング)、最適化が効果的・保守可能_

## フェーズ7: 文書化と最終クリーンアップ

- [x] 27. 包括的文書の作成
  - ファイル: backend/README.md, docs/backend-architecture.md
  - 新アーキテクチャとデプロイメント手順の文書化
  - 開発者オンボーディングガイドの作成
  - 目的: 将来の開発と保守のサポート
  - _活用: 既存文書パターンとアーキテクチャ決定_
  - _要件: 非機能要件 - 使いやすさ_
  - _Prompt: Role: ソフトウェアアーキテクチャ文書化を専門とするテクニカルライター | Task: 使いやすさ要件に従ってリファクタリングされたバックエンドアーキテクチャの包括的文書を作成 | Restrictions: 明確で実行可能な内容、必要な詳細を全て含む、既存文書との一貫性を維持 | Success: 文書が包括的・有用、開発者オンボーディングが合理化、アーキテクチャ決定が適切に文書化_

- [x] 28. 最終クリーンアップと検証
  - ファイル: プロジェクト全体（不要ファイルのクリーンアップ）
  - 非推奨ファイルの削除と不要コードのクリーンアップ
  - 全要件達成の検証
  - 目的: クリーンで保守可能なコードベースでリファクタリングを完了
  - _活用: 監査結果と移行文書_
  - _要件: 全要件_
  - _Prompt: Role: コード品質とシステム検証を専門とするシニア開発者 | Task: 不要コードを削除し、全要件達成を検証して最終クリーンアップを完了 | Restrictions: 必要な機能を削除しない、クリーンアップの安全性を確保、元の要件全てに対して検証 | Success: コードベースがクリーン・保守可能、全要件達成・検証済み、不要コードが残らない_

- [x] 29. 本番デプロイメントと稼働開始
  - ファイル: 本番環境設定
  - リファクタリングされたシステムの本番環境へのデプロイ
  - デプロイメント監視と機能検証
  - 目的: 成功した本番デプロイメントでリファクタリングプロジェクトを完了
  - _活用: デプロイメント自動化と監視システム_
  - _要件: 全要件_
  - _Prompt: Role: 本番デプロイメントとシステム検証を専門とするリリースマネージャー | Task: 全要件に従ってリファクタリングされたシステムを本番にデプロイし、機能を検証 | Restrictions: データ損失ゼロを確保、ダウンタイムを最小化、ロールバック計画を準備、システムを注意深く監視 | Success: 本番デプロイメントが成功、全機能が正常動作、システムパフォーマンスが要件を満たす、ユーザーがサービス中断を経験しない_

## フェーズ8: 追加の緊急修正と拡張

- [x] 30. personalizedフィード用RPC関数の作成
  - ファイル: supabase/migrations/
  - get_videos_feed PostgreSQL関数の実装
  - パーソナライズドレコメンデーション用RPC関数群の作成
  - 目的: 統合コンテンツAPIのpersonalizedフィードタイプを正常動作させる
  - _活用: 既存のvideo_embeddings、user_embeddingsテーブル_
  - _要件: 要件1_
  - _Prompt: Role: PostgreSQL関数開発とパーソナライゼーションアルゴリズムを専門とするデータベース開発者 | Task: 統合コンテンツAPIのpersonalizedフィードを動作させるため、get_videos_feed RPC関数と関連するパーソナライズド推薦関数を実装 | Restrictions: 既存のテーブル構造を維持、パフォーマンスを<500ms以下に保つ、スケーラブルな実装を確保 | Success: personalizedフィードが正常動作、RPC関数がパフォーマンス要件を満たす、パーソナライゼーションロジックが適切に実装_

- [x] 31. 統合コンテンツAPIの包括的動作テスト
  - ファイル: backend/tests/integration/content/
  - 全フィードタイプ（explore、personalized、latest、popular、random）の動作テスト
  - エラーハンドリングとフォールバック機能のテスト
  - 目的: 統合コンテンツAPIの完全動作保証
  - _活用: 統合されたcontent/feed/index.ts API_
  - _要件: 要件5_
  - _Prompt: Role: API統合テストとコンテンツシステムを専門とするテストエンジニア | Task: 統合コンテンツAPIの全フィードタイプとエラーハンドリングの包括的テストを作成し実行 | Restrictions: 全フィードタイプをテスト、データベース依存関係を適切にモック、パフォーマンステストを含む | Success: 全フィードタイプが正常動作、エラーハンドリングが適切、API契約が全て満たされる_

- [x] 32. 欠落データベース関数とプロシージャの実装
  - ファイル: supabase/migrations/
  - get_random_videosその他の欠落RPC関数の実装
  - データベーススキーマとEdge Functions間の依存関係修正
  - 目的: 全Edge Functions機能の完全動作保証
  - _活用: 既存のデータベーススキーマとEdge Functions実装_
  - _要件: 要件1、要件3_
  - _Prompt: Role: データベースアーキテクトとPostgreSQL開発を専門とするバックエンド開発者 | Task: Edge Functionsの正常動作のため、欠落しているデータベース関数・プロシージャを実装し、スキーマ依存関係を修正 | Restrictions: 既存データ整合性を維持、パフォーマンスを最適化、セキュリティベストプラクティスを適用 | Success: 全Edge Functionsが依存関係エラーなしで動作、データベース関数が効率的、スキーマが一貫性を保つ_

- [x] 33. Edge Functions共有依存関係の標準化
  - ファイル: supabase/functions/_shared/
  - 認証ヘルパー、データベース接続、エラーハンドリングの統一実装
  - 全Edge Functions間でのコード重複削減
  - 目的: コード保守性向上と一貫性確保
  - _活用: 既存_sharedユーティリティと認証パターン_
  - _要件: 要件1_
  - _Prompt: Role: 共有ライブラリ設計と依存関係管理を専門とするシステムアーキテクト | Task: Edge Functions間の共通機能を_sharedに統合し、認証・データベース・エラーハンドリングを標準化 | Restrictions: 既存Edge Functions機能を破らない、後方互換性を維持、共有ライブラリを十分にテスト | Success: コード重複が大幅削減、全Edge Functionsが共通インターフェースを使用、保守性が向上_